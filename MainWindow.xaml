<mah:MetroWindow x:Class="NetSpoofer.MainWindow" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls" Title="NetSpoofer" Height="720" Width="1200" WindowStartupLocation="CenterScreen">
  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <!-- Header toolbar -->
    <Border Padding="10" Background="{DynamicResource MahApps.Brushes.ThemeBackground}">
      <StackPanel Orientation="Horizontal">
        <StackPanel.Resources>
          <Style TargetType="{x:Type FrameworkElement}">
            <Setter Property="Margin" Value="0,0,10,0"/>
          </Style>
        </StackPanel.Resources>
        <TextBlock Text="Interface:" VerticalAlignment="Center"/>
        <ComboBox Width="320" ItemsSource="{Binding Interfaces}" SelectedItem="{Binding SelectedInterface}" DisplayMemberPath="Description"/>
        <TextBlock Text="Gateway IP:" VerticalAlignment="Center"/>
        <TextBox Width="150" Text="{Binding GatewayIp}"/>
        <!-- Removed Target IP (hosts are auto-discovered) -->
        <Button Content="Start" Command="{Binding StartCommand}"/>
        <Button Content="Stop" Command="{Binding StopCommand}"/>
        <Button Content="Scan subnet" Command="{Binding ScanSubnetCommand}"/>
      </StackPanel>
    </Border>

    <Grid Grid.Row="1" Margin="10">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="2*"/>
        <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

      <!-- Clients table is now the main view -->
      <GroupBox Header="Clients" Margin="0,0,10,0" Grid.Column="0">
        <DataGrid ItemsSource="{Binding Hosts}" AutoGenerateColumns="False" IsReadOnly="False">
          <DataGrid.Columns>
            <DataGridTextColumn Header="PC / Device name" Binding="{Binding Name}" Width="180"/>
            <DataGridTextColumn Header="IP" Binding="{Binding Ip}" Width="140"/>
            <DataGridTextColumn Header="MAC" Binding="{Binding Mac}" Width="180"/>
            <DataGridTextColumn Header="Vendor" Binding="{Binding Vendor}" Width="160"/>
            <DataGridTextColumn Header="Download (KB/s)" Binding="{Binding DownloadKbps}" Width="140"/>
            <DataGridTextColumn Header="Upload (KB/s)" Binding="{Binding UploadKbps}" Width="140"/>

            <!-- Numeric-only caps -->
            <DataGridTemplateColumn Header="Down cap (KB/s)" Width="140">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <mah:NumericUpDown Minimum="0" Maximum="102400"
                                   Value="{Binding DownLimitKbps, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                   Interval="1" />
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>
            <DataGridTemplateColumn Header="Up cap (KB/s)" Width="140">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <mah:NumericUpDown Minimum="0" Maximum="102400"
                                   Value="{Binding UpLimitKbps, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                   Interval="1" />
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>

            <DataGridCheckBoxColumn Header="Block" Binding="{Binding Blocked, Mode=TwoWay}" Width="80"/>
          </DataGrid.Columns>
        </DataGrid>
      </GroupBox>
        <StackPanel Grid.Column="1">
          <GroupBox Header="ARP Spoofing">
            <StackPanel>
              <StackPanel.Resources>
                <Style TargetType="{x:Type FrameworkElement}">
                  <Setter Property="Margin" Value="0,8,0,0"/>
                </Style>
              </StackPanel.Resources>
              <CheckBox Content="Enable ARP Spoofing" IsChecked="{Binding EnableArp}"/>
              <CheckBox Content="Bridge Forwarding" IsChecked="{Binding EnableForwarding}"/>
            </StackPanel>
          </GroupBox>
          <GroupBox Header="DNS Spoofing">
            <StackPanel>
              <StackPanel.Resources>
                <Style TargetType="{x:Type FrameworkElement}">
                  <Setter Property="Margin" Value="0,8,0,0"/>
                </Style>
              </StackPanel.Resources>
              <CheckBox Content="Enable DNS Spoofing" IsChecked="{Binding EnableDns}"/>
              <DockPanel>
                <TextBox Width="220" Margin="0,0,5,0" Text="{Binding DnsDomain}" mah:TextBoxHelper.Watermark="Domain (e.g., example.com)"/>
                <TextBox Width="140" Margin="0,0,5,0" Text="{Binding DnsIp}" mah:TextBoxHelper.Watermark="Fake IP"/>
                <Button Content="Add" Command="{Binding AddDnsRuleCommand}"/>
              </DockPanel>
              <ListBox ItemsSource="{Binding DnsRules}" DisplayMemberPath="Display" Height="120"/>
            </StackPanel>
          </GroupBox>
          <GroupBox Header="Bandwidth Limiter">
            <StackPanel>
              <StackPanel.Resources>
                <Style TargetType="{x:Type FrameworkElement}">
                  <Setter Property="Margin" Value="0,8,0,0"/>
                </Style>
              </StackPanel.Resources>
              <CheckBox Content="Enable Bandwidth Limit" IsChecked="{Binding EnableLimit}"/>
              <StackPanel Orientation="Horizontal">
                <StackPanel.Resources>
                  <Style TargetType="{x:Type FrameworkElement}">
                    <Setter Property="Margin" Value="0,0,6,0"/>
                  </Style>
                </StackPanel.Resources>
                <TextBlock Text="Down (KB/s):"/>
                <Slider Width="150" Minimum="1" Maximum="102400" Value="{Binding DownKbps}"/>
                <TextBlock Text="{Binding DownKbps}"/>
              </StackPanel>
              <StackPanel Orientation="Horizontal">
                <StackPanel.Resources>
                  <Style TargetType="{x:Type FrameworkElement}">
                    <Setter Property="Margin" Value="0,0,6,0"/>
                  </Style>
                </StackPanel.Resources>
                <TextBlock Text="Up (KB/s):"/>
                <Slider Width="150" Minimum="1" Maximum="102400" Value="{Binding UpKbps}"/>
                <TextBlock Text="{Binding UpKbps}"/>
              </StackPanel>
              <StackPanel Orientation="Horizontal">
                <StackPanel.Resources>
                  <Style TargetType="{x:Type FrameworkElement}">
                    <Setter Property="Margin" Value="0,0,6,0"/>
                  </Style>
                </StackPanel.Resources>
                <TextBlock Text="Extra Delay (ms):"/>
                <Slider Width="150" Minimum="0" Maximum="1000" Value="{Binding ExtraDelayMs}"/>
                <TextBlock Text="{Binding ExtraDelayMs}"/>
              </StackPanel>
            </StackPanel>
          </GroupBox>
          <GroupBox Header="Status">
            <TextBlock Text="{Binding Status}" TextWrapping="Wrap"/>
          </GroupBox>
        </StackPanel>
      </Grid>
    </Grid>
</mah:MetroWindow>